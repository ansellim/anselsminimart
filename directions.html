<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Get Directions</title>

  <!-- load in Google Maps API -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsOu2g25QpezRc_3DjQpRBHtq85bn3yik&callback=initMap&libraries=&v=weekly"
    defer></script>

  <!-- Bootstrap, Jquery -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <!-- PWA-related -->
  <link rel="manifest" href="JSON/manifest.json" />
  <link rel="apple-touch-icon" href="images/icon-192x192.png" />
  <meta name="theme-color" content="#f69435" />

  <!-- this is required - otherwise map doesn't show... -->
  <style type="text/css">
    #map {
      min-height: 400px;
      width: 100%;
      height: 100%;
    }
  </style>

  <!-- Load in service worker. Service worker file is in sw.js which I generated using Workbox tools. -->
  <script src="javascript/load_in_service_worker.js"></script>

</head>

<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">Ansel's Minimart</a>
      </div>
      <ul class="nav navbar-nav">
        <li class="active"><a href="index.html">Home</a></li>
        <li><a href="products.html">Browse Products</a></li>
        <li><a href="shoppinglist.html">Create Shopping List</a></li>
        <li><a href="directions.html">How To Get Here</a></li>
        <li><a href="feedback_form.html">Feedback Form</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <h1>How to get here!</h1>
  </div>

  <div class="container">
    <h2>Address</h2>
    <p>
      We are located in T21 building at Singapore Polytechnic. Our address is:
      500 Dover Road, Singapore 139651.
    </p>
  </div>


  <p hidden id="pos_lat"></p>
  <p hidden id="pos_lng"></p>

  <script>
    let map;
    let myLat;
    let myLng;
    const myLatLng = { lat: 1.3115957122081283, lng: 103.77520417009457 };

    // function initMap() {

    //   console.log("The init map function has been called");

    //   map = new google.maps.Map(document.getElementById("map"), {
    //     center: myLatLng,
    //     zoom: 16,
    //   });

    //   if (navigator.geolocation) {
    //     navigator.geolocation.getCurrentPosition(function (position) {
    //       myLat = position.coords.latitude;
    //       myLon = position.coords.longitude;
    //       //console.log(myLat); //This shows me the latitude
    //       Displaylat_lng(myLat, myLon);
    //     });
    //   };

    //   function Displaylat_lng(lat, lng) {
    //     console.log('Lat ==> ' + lat + ' lng ==> ' + lng);
    //     $('#pos_lat').html(lat);
    //     $('#pos_lng').html(lng)
    //   };

    // };


    function initMap() {
      var directionsService = new google.maps.DirectionsService();
      var directionsRenderer = new google.maps.DirectionsRenderer();
      var anselMinimart = new google.maps.LatLng(1.3115957122081283, 103.77520417009457);
      var mapOptions = {
        zoom: 16,
        center: anselMinimart
      }
      var map = new google.maps.Map(document.getElementById('map'), mapOptions);
      new google.maps.Marker({
        position: myLatLng,
        map,
        title: "Ansel's Minimart",
      });
      directionsRenderer.setMap(map);
      directionsRenderer.setPanel(document.getElementById('directionsPanel'));


      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          myLat = position.coords.latitude;
          myLon = position.coords.longitude;
          //console.log(myLat); //This shows me the latitude
          Displaylat_lng(myLat, myLon);
        });
      };

      function Displaylat_lng(lat, lng) {
        console.log('Lat ==> ' + lat + ' lng ==> ' + lng);
        $('#pos_lat').html(lat);
        $('#pos_lng').html(lng)
      };


      var originLatitude;
      var originLongitude;


      function calcRoute() {

        var start = originLatitude + "," + originLongitude;
        console.log(originLatitude);
        console.log(originLongitude);
        var end = "500 Dover Rd, Singapore"; // "1.3115957122081283,  103.77520417009457";
        var request = {
          origin: start,
          destination: end,
          travelMode: 'TRANSIT'
        };
        directionsService.route(request, function (response, status) {
          if (status == 'OK') {
            directionsRenderer.setDirections(response);
          }
        });
      };

      $("#btn").on("click", function () {
        originLatitude = $("#pos_lat").html();
        originLongitude = $("#pos_lng").html();
        calcRoute();
      });

    };


    // adapted from https://developers.google.com/maps/documentation/javascript/examples/directions-panel.



  </script>
  <!-- 
  <div class="container"><br /></div> -->

  <div class="container">
    <h2>Let me show you how to get here!</h2>
    <button id="btn">Click here to get directions</button>
    <p id="directions_information"></p>
  </div>

  <div class="container">
    <!-- <div id="map"></div> -->
    <div id="map" style="float:left;width:100%;height:100%"></div>
    <div id="directionsPanel" style="float:right;width:100%;height:100%"></div>
  </div>

  <script>

    // $("#btn").on("click", function () {
    //   var originLatitude = $("#pos_lat").html();
    //   var originLongitude = $("#pos_lng").html();
    //   let my_url = "https://maps.googleapis.com/maps/api/directions/json?origin=" + originLatitude + "," + originLongitude + "&destination=" + "Singapore+Polytechnic" + "&key=AIzaSyBsOu2g25QpezRc_3DjQpRBHtq85bn3yik";
    //   console.log(my_url);

    //   function printDirections() {
    //     $.ajax({
    //       url: my_url,
    //       type: "GET",
    //       dataType: 'jsonp',
    //       cache: false,
    //       success: function (response) {
    //         alert(response);
    //       }
    //     });
    //   };

    //   printDirections();

    // });



  </script>



  <div class="container">
    <h2>Opening hours</h2>
    <p>Monday-Friday 8am-5pm</p>
    <p>Weekends 8am-12nn</p>
  </div>
</body>

<footer class="bg-light text-center text-lg-start">
  <br>
  <!-- Copyright -->
  <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2)">
    Â© 2020 Copyright:
    <a class="text-dark" href="http://ansellim.github.io">Ansel Lim</a>
  </div>
  <!-- Copyright -->
</footer>

</html>